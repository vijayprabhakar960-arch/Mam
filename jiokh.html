<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Satta - UI</title>
  <style>
    :root{--primary:#1565d8;--accent:#f39c12}
    body{font-family:Inter,Arial,Helvetica,sans-serif;background:#f3f6fb;margin:0;padding:18px;color:#17223b}
    .wrap{max-width:940px;margin:0 auto}
    .card{background:#fff;border-radius:12px;padding:16px;margin-bottom:14px;box-shadow:0 8px 30px rgba(14,30,60,0.06)}
    h1,h2{margin:0 0 8px}
    input,select,button{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #e6eef8;font-size:15px;box-sizing:border-box}
    button{background:var(--primary);color:#fff;border:none;cursor:pointer}
    button.alt{background:transparent;color:var(--primary);border:1px solid rgba(21,101,216,0.12)}
    .row{display:flex;gap:8px}
    .col{flex:1}
    .muted{color:#6b7280;font-size:13px}
    pre{background:#0b1220;color:#bfe6a5;padding:10px;border-radius:8px;overflow:auto}
    .small{font-size:13px;color:#6b7280}
    @media(min-width:800px){ .row-2{display:flex;gap:12px} }
  </style>
</head>
<body>
  <div class="wrap">

    <div class="card" id="authCard">
      <h1>Satta App</h1>
      <p class="muted">Signup or login to start — uses your Google Apps Script backend.</p>

      <div id="signupForm">
        <h2>Signup</h2>
        <input id="s_name" placeholder="Name" />
        <input id="s_phone" placeholder="Phone (unique)" />
        <input id="s_pass" placeholder="Password" type="password" />
        <div style="margin-top:8px" class="row">
          <button id="btnSignup" class="col">Create account</button>
          <button id="showLogin" class="col alt">Already have account</button>
        </div>
        <p id="signupMsg" class="small"></p>
      </div>

      <div id="loginForm" style="display:none">
        <h2>Login</h2>
        <input id="l_phone" placeholder="Phone" />
        <input id="l_pass" placeholder="Password" type="password" />
        <div style="margin-top:8px" class="row">
          <button id="btnLogin" class="col">Login</button>
          <button id="showSignup" class="col alt">Create account</button>
        </div>
        <p id="loginMsg" class="small"></p>
      </div>
    </div>

    <div id="appUI" style="display:none">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 id="welcome">Welcome</h2>
            <div class="small muted" id="phoneSpan"></div>
          </div>
          <div style="text-align:right">
            <div class="small">Wallet: ₹<span id="wallet">0</span></div>
            <div style="margin-top:8px">
              <button id="btnLogout" class="alt">Logout</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Add / Withdraw</h3>
        <div class="row-2">
          <div class="col">
            <input id="tx_amount" placeholder="Amount (example: 500)" type="number" />
          </div>
          <div style="width:160px">
            <button id="btnAdd">Add</button>
          </div>
        </div>
        <div style="margin-top:8px" class="row-2">
          <div class="col">
            <input id="wd_amount" placeholder="Withdraw amount" type="number" />
          </div>
          <div style="width:160px">
            <button id="btnWithdraw" style="background:#e5533c">Withdraw</button>
          </div>
        </div>
        <p id="txMsg" class="small muted"></p>
      </div>

      <div class="card">
        <h3>Place Bet</h3>
        <label class="small muted">Market</label>
        <select id="market">
          <option value="Sridevi">Sridevi</option>
          <option value="Time Bazar">Time Bazar</option>
          <option value="Kalyan">Kalyan</option>
          <option value="Milan Day">Milan Day</option>
        </select>

        <div class="row" style="margin-top:8px">
          <input id="bet_number" placeholder="Enter number (0-9 or as allowed)" class="col" />
          <input id="bet_amount" placeholder="Amount" type="number" style="width:160px" />
        </div>

        <div style="margin-top:10px" class="row">
          <button id="btnPlace" class="col">Submit Bet</button>
          <button id="btnRefresh" class="col alt">Refresh Wallet</button>
        </div>
        <p id="betMsg" class="small muted"></p>
      </div>

      <div class="card">
        <h3>Quick Debug / Server Response</h3>
        <pre id="debug">No actions yet</pre>
      </div>
    </div>

  </div>

<script>
/*
  Single-file UI that talks to your Apps Script doGet actions.
  Replace API_URL with your deployed web app /exec URL.
*/
const API_URL = "https://script.google.com/macros/s/AKfycbw_ij0s73-P_apiWW1KECp0iJtq1ZbBYl5Ghp4NZ2yeackaP2zX__kFiZ7bQC98taoHPg/exec"; // <-- PUT your /exec URL here

if(!API_URL || API_URL.includes("https://script.google.com/macros/s/AKfycbw_ij0s73-P_apiWW1KECp0iJtq1ZbBYl5Ghp4NZ2yeackaP2zX__kFiZ7bQC98taoHPg/exec")) {
  alert("Please open this file and set API_URL to your Apps Script /exec URL.");
}

// helper: build GET url with encoded params
function apiUrl(params){
  const q = Object.keys(params).map(k => encodeURIComponent(k)+"="+encodeURIComponent(params[k])).join("&");
  return API_URL + "?" + q;
}

function logDebug(o){
  const el = document.getElementById("debug");
  el.textContent = typeof o === 'string' ? o : JSON.stringify(o, null, 2);
}

// UI elements
const s_name = document.getElementById("s_name");
const s_phone = document.getElementById("s_phone");
const s_pass = document.getElementById("s_pass");
const signupMsg = document.getElementById("signupMsg");

const l_phone = document.getElementById("l_phone");
const l_pass = document.getElementById("l_pass");
const loginMsg = document.getElementById("loginMsg");

const welcome = document.getElementById("welcome");
const phoneSpan = document.getElementById("phoneSpan");
const walletEl = document.getElementById("wallet");
const txMsg = document.getElementById("txMsg");
const betMsg = document.getElementById("betMsg");
const debugPre = document.getElementById("debug");

// toggles
document.getElementById("showLogin").onclick = ()=>{ document.getElementById("signupForm").style.display='none'; document.getElementById("loginForm").style.display='block'; }
document.getElementById("showSignup").onclick = ()=>{ document.getElementById("signupForm").style.display='block'; document.getElementById("loginForm").style.display='none'; }

// SIGNUP
document.getElementById("btnSignup").addEventListener("click", async ()=>{
  signupMsg.textContent = "Creating account...";
  try{
    const url = apiUrl({ action: "signup", name: s_name.value, phone: s_phone.value, password: s_pass.value });
    const res = await fetch(url);
    const j = await res.json();
    signupMsg.textContent = j.message || JSON.stringify(j);
    logDebug(j);
  }catch(err){
    signupMsg.textContent = "Network error";
    logDebug(err.toString());
  }
});

// LOGIN
document.getElementById("btnLogin").addEventListener("click", async ()=>{
  loginMsg.textContent = "Logging in...";
  try{
    const url = apiUrl({ action: "login", phone: l_phone.value, password: l_pass.value });
    const res = await fetch(url);
    const j = await res.json();
    logDebug(j);
    if(j.success){
      // store simple session (phone)
      localStorage.setItem("satta_phone", l_phone.value);
      // show app UI
      showApp(l_phone.value, j.name || "");
    } else {
      loginMsg.textContent = j.message || "Login failed";
    }
  }catch(err){
    loginMsg.textContent = "Network error";
    logDebug(err.toString());
  }
});

// SHOW APP (after login)
function showApp(phone, name){
  document.getElementById("authCard").style.display = "none";
  document.getElementById("appUI").style.display = "block";
  welcome.textContent = name ? `Hi, ${name}` : "Hi, Player";
  phoneSpan.textContent = "Phone: " + phone;
  refreshWallet();
}

// LOGOUT
document.getElementById("btnLogout").addEventListener("click", ()=>{
  localStorage.removeItem("satta_phone");
  location.reload();
});

// REFRESH WALLET
async function refreshWallet(){
  const phone = localStorage.getItem("satta_phone");
  if(!phone) return;
  txMsg.textContent = "";
  betMsg.textContent = "";
  try{
    const url = apiUrl({ action: "wallet", phone });
    const res = await fetch(url);
    const j = await res.json();
    if(j.success) walletEl.textContent = Number(j.balance) || 0;
    else walletEl.textContent = 0;
    logDebug(j);
  }catch(err){
    logDebug(err.toString());
  }
}

// AUTO-LOGIN if session exists
(function init(){
  const phone = localStorage.getItem("satta_phone");
  if(phone) {
    // attempt to fetch name via login action with empty password won't work; so just show saved phone
    showApp(phone, "");
  }
})();

// ADD MONEY
document.getElementById("btnAdd").addEventListener("click", async ()=>{
  const phone = localStorage.getItem("satta_phone");
  if(!phone){ alert("Please login"); return; }
  const amount = document.getElementById("tx_amount").value;
  if(!amount || Number(amount) <= 500){ txMsg.textContent = "Enter valid amount"; return; }
  try{
    const url = apiUrl({ action: "addmoney", phone, amount });
    const res = await fetch(url);
    const j = await res.json();
    txMsg.textContent = j.message || JSON.stringify(j);
    logDebug(j);
    setTimeout(refreshWallet, 800);
  }catch(err){
    txMsg.textContent = "Network error";
    logDebug(err.toString());
  }
});

// WITHDRAW
document.getElementById("btnWithdraw").addEventListener("click", async ()=>{
  const phone = localStorage.getItem("satta_phone");
  if(!phone){ alert("Please login"); return; }
  const amount = document.getElementById("wd_amount").value;
  if(!amount || Number(amount) <= 0){ txMsg.textContent = "Enter valid amount"; return; }
  try{
    const url = apiUrl({ action: "withdraw", phone, amount });
    const res = await fetch(url);
    const j = await res.json();
    txMsg.textContent = j.message || JSON.stringify(j);
    logDebug(j);
    setTimeout(refreshWallet, 800);
  }catch(err){
    txMsg.textContent = "Network error";
    logDebug(err.toString());
  }
});

// PLACE BET
document.getElementById("btnPlace").addEventListener("click", async ()=>{
  const phone = localStorage.getItem("satta_phone");
  if(!phone){ alert("Please login"); return; }
  const market = document.getElementById("market").value;
  const number = document.getElementById("bet_number").value.trim();
  const amount = document.getElementById("bet_amount").value;
  if(!number){ betMsg.textContent = "Enter number"; return; }
  if(!amount || Number(amount) <= 0){ betMsg.textContent = "Enter valid amount"; return; }

  try{
    const url = apiUrl({ action: "bet", phone, market, number, amount });
    const res = await fetch(url);
    const j = await res.json();
    betMsg.textContent = j.message || JSON.stringify(j);
    logDebug(j);
    setTimeout(refreshWallet, 800);
  }catch(err){
    betMsg.textContent = "Network error";
    logDebug(err.toString());
  }
});

// REFRESH button
document.getElementById("btnRefresh").addEventListener("click", refreshWallet);
</script>
</body>
</html>